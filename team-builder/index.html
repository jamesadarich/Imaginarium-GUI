<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
		<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
		<link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'>
		<link href='css/global.css' rel='stylesheet' type='text/css'>
		<style>
			.panel-heading img{
				height: 20px;
			}
			.panel-heading{
				display: inline;
			}

			.panel-heading .media{
				margin-left: 10px;
			}
          
        	.alt-color{
            	background-color: #eee;
            }
          
        	#page-content{
            	text-align: center;
            }

			h3{
				vertical-align: middle;
			}

			.team-list div{
				padding: 5px;
			}

			#create-teams{
				margin: 10px 0;
			}

			#all-members{
				margin-bottom: 10px;
			}

			.btn{
				-webkit-border-radius: 0px;
				-moz-border-radius: 0px;
				-o-border-radius: 0px;
				border-radius: 0px;
			}
			.btn-default:focus{
            	background-color: #008080;
            	color: #fff;
			}

			.team-list{
				border: 1px #eee solid;
			}

			#teams .col-xs-6{
				padding: 0 3px;				
			}


			.btn-default:hover{
            	background-color: #008080;
            	color: #fff;
			}

			.nav-tabs li{
				width: 50%;
			}

			.team-title{
            	background-color: #008080;
            	color: #fff;
            	font-weight: bold;
            	padding: 5px;
            	font-size: 1.2em;
			}
		</style>
		<script>
			$(document).ready(function(){
				var requestUri = 'api/get-team.php';
				$('#teams').hide();

				$.ajax({
					url: requestUri,				 
					dataType: 'json',
				}).done(function(response){
					
					if (response.teamMembers.Count === 0){
						$alert = $('<div/>');
						$alert.addClass('alert');
						$alert.addClass('alert-danger');
						$alert.addClass('fade');
						$alert.addClass('in');
						$alert.attr('role', 'alert');

						$alertClose = $('<button/>');
						$alertClose.addClass('close');
						$alertClose.attr('type', 'button');
						$alertClose.data('dismiss', 'alert');
						$alertClose.append('&#x2716;');
						$alertClose.on('click', function(){$alert.alert('close');});
						$alert.append($alertClose);

						$alert.append('No Team Members Found - Refresh the Page');

						$('#alerts').append($alert);
					}
					else
					{
						$createTeams = $('#create-teams');
						$createTeams.removeClass('disabled');
						$createTeams.text('Create Teams');
						$createTeams.on('click', createTeams);

						var $teamPanel = $('<div/>');
						$teamPanel.addClass('panel');
						$teamPanel.addClass('panel-default');
						$teamPanel.addClass('container');

						var $teamHeadingLink = $('<a data-toggle="collapse" data-parent="#team-list"/>');
						$teamHeadingLink.attr('href', '#all-members');
						$teamHeadingLink.addClass('collapsed');

						$teamPanel.append($teamHeadingLink);
						var $teamHeading = $('<h4/>');
						$teamHeading.append('Select Team Members');
						$teamHeadingLink.append($teamHeading);

						var $teamList = $('<div/>');
						$teamList.attr('id', 'all-members');
						$teamList.addClass('panel-collapse');
						$teamList.addClass('collapse');

						$.each(response.teamMembers, function(index, teamMember){
							var $teamMemberButton = $('<button/>');
							$teamMemberButton.attr('type', 'button');
							$teamMemberButton.addClass('btn');
							$teamMemberButton.addClass('btn-default');
							//$teamMemberButton.addClass('active');
							$teamMemberButton.addClass('col-xs-6');
							$teamMemberButton.data('toggle', 'button');
							$teamMemberButton.append(teamMember.name);

							$teamMemberButton.on('click', function(e){
								$button = $(e.target);

								if ($button.hasClass('active')){
									$button.removeClass('active');
								}
								else{
									$button.addClass('active');
								}
							});

							$teamList.append($teamMemberButton);


						});

						$teamPanel.append($teamList);

						$('#team-list').append($teamPanel);
					}
				});
			});

			function createTeams(){

				$('#teams').hide(500, function(){

					$('#alerts').empty();

					$('#team-one').empty();
					$('#team-two').empty();

					var $players = $('button', '#team-list');

					if (!$players.hasClass('active')){

						$alert = $('<div/>');
						$alert.addClass('alert');
						$alert.addClass('alert-warning');
						$alert.addClass('fade');
						$alert.addClass('in');
						$alert.attr('role', 'alert');

						$alertClose = $('<button/>');
						$alertClose.addClass('close');
						$alertClose.attr('type', 'button');
						$alertClose.data('dismiss', 'alert');
						$alertClose.append('&#x2716;');
						$alertClose.on('click', function(){$alert.alert('close');});
						$alert.append($alertClose);

						$alert.append('No Team Members Selected');

						$('#alerts').append($alert);
					}
					else{						
						var playerNames = [];

						for (var i = 0; i < $players.length; i++){
							if ($($players[i]).hasClass('active')){
								playerNames.push($($players[i]).text());
							}
						}

						var teamOne = [];
						var teamTwo = [];

						while (playerNames.length > 0){
							var index = Math.floor(Math.random() * playerNames.length);
							if (teamOne.length <= teamTwo.length){
								teamOne.push(playerNames[index]);
							}
							else{
								teamTwo.push(playerNames[index]);
							}
							playerNames.splice(index, 1);
						}

						$teamOneDiv = $('<div/>');

						$.each(teamOne, function(index, teamMember){
							$teamMemberListItem = $('<div/>');
							$teamMemberListItem.append(teamMember);
		                  
			                if(index % 2 !==0){
			                	$teamMemberListItem.addClass('alt-color');
			                }

							$teamOneDiv.append($teamMemberListItem);
		                  
						});

						$('#team-one').append($teamOneDiv);
						$teamOneDiv.addClass('team-list');

						$teamTwoDiv = $('<div/>');

						$.each(teamTwo, function(index, teamMember){
							$teamMemberListItem = $('<div/>');
							$teamMemberListItem.append(teamMember);

			                if(index % 2 !==0){
			                	$teamMemberListItem.addClass('alt-color');
			                }

							$teamTwoDiv.append($teamMemberListItem);
						});

						$('#team-two').append($teamTwoDiv);
						$teamTwoDiv.addClass('team-list');

						$('#teams').show(500);
					}

				});
			}
		</script>
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		  <!-- We use the fluid option here to avoid overriding the fixed width of a normal container within the narrow content columns. -->
		  <div class="container">
		      <a class="navbar-brand" style="padding:0px;" href="#"><h4>SETT IMAGINARIUM</h4></a>
		    <div class="navbar-header">
		      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-6">
		        <span class="sr-only">Toggle navigation</span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </button>
		    </div>
		    <div class="navbar-collapse collapse" id="bs-example-navbar-collapse-6" style="height: auto;">
		      <ul class="nav navbar-nav navbar-right">
		        <li><a href="#">These</a></li>
		        <li><a href="#">Links</a></li>
		        <li><a href="#">Go</a></li>
		        <li><a href="#">Nowhere</a></li>
		      </ul>
		    </div><!-- /.navbar-collapse -->
		  </div>
		</nav>
		<div id="main-content">
			<div id="page-content" class="container">
				<h1>Team Builder!!!</h1>
				<div id="alerts"></div>
				<div class="panel-group" id="team-list">
				</div>
				<button type="button" id="create-teams" class="btn btn-default col-xs-12 disabled">No Teams</button>
				<div id="teams">
					<div class="col-xs-6">
						<div class="team-title">Team One</div>
						<div id="team-one"></div>
					</div>
					<div class="col-xs-6">
						<div class="team-title">Team Two</div>
						<div id="team-two"></div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>